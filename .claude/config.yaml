# Claude Code Orchestrator Configuration

# Orchestrator settings
orchestrator:
  state_file: ".claude/orchestrator_state.json"
  max_parallel_agents: 2
  timeout_minutes: 30
  retry:
    retries: 2
    backoff: 2.0
    jitter: 0.25
    retryable_exit_codes: [75, 101]
    retryable_messages:
      - "rate limit"
      - "transient network"

# Subagent definitions
subagents:
  architect:
    enabled: true
    prompt_template: subagent_prompts/architect.md
    checkpoint_artifacts:
      - architecture.md
      - technical_spec.md
      - data_models.md

  developer:
    enabled: true
    prompt_template: subagent_prompts/developer.md
    checkpoint_artifacts:
      - src/**/*
      - implementation_notes.md

  qa:
    enabled: true
    prompt_template: subagent_prompts/qa.md
    checkpoint_artifacts:
      - test_plan.md
      - test_results.md
      - qa_report.md

  documentarian:
    enabled: true
    prompt_template: subagent_prompts/documentarian.md
    checkpoint_artifacts:
      - README.md
      - USER_GUIDE.md
      - API_REFERENCE.md
      - docs/**/*

  consensus:
    enabled: true
    prompt_template: subagent_prompts/consensus.md
    checkpoint_artifacts:
      - consensus_decisions.md
      - conflict_resolution.md
      - checkpoint_approvals.md

  reviewer:
    enabled: false  # Optional agent
    prompt_template: subagent_prompts/reviewer.md
    checkpoint_artifacts:
      - code_review.md
      - improvements.md
      - review_checklist.md

  data:
    enabled: true
    prompt_template: subagent_prompts/data.md
    checkpoint_artifacts:
      - data_models/**/*
      - src/data/**/*
      - analytics/queries/**/*
      - docs/data_documentation.md
      - models/**/*
      - data/processed/**/*
    entrypoints:
      ingest: "python -m src.cli ingest"
      transform: "python -m src.cli transform"
      train: "python -m src.cli train"
      evaluate: "python -m src.cli evaluate"
      pipeline: "python -m src.pipelines.demo_pipeline"
      status: "python -m src.cli status"

  steward:
    enabled: true
    role: Repository Hygiene & Cleanliness Maintainer
    prompt_template: subagent_prompts/steward.md
    checkpoint_artifacts:
      - reports/repo_hygiene_report.md
      - reports/PR_PLAN.md
      - reports/dead_code.md
      - reports/large_files.csv
      - reports/orphans.csv
    entrypoints:
      scan: "python3 -m src.steward.scanner"
      dead_code: "python3 -m src.steward.dead_code"
      notebooks: "python3 -m src.steward.notebooks"
      aggregate: "python3 -m src.steward.glue"

# Workflow configuration
workflow:
  phases:
    - name: planning
      agents: [architect]
      requires_consensus: true

    - name: data_engineering
      agents: [data]
      requires_consensus: false
      optional: true  # Only run when data/analytics work is needed
      artifacts_required:
        - data/processed/**/*.csv
        - models/metrics.json
      handoff_to: developer

    - name: development
      agents: [developer]
      requires_consensus: false

    - name: quality_assurance
      agents: [qa]
      requires_consensus: true

    - name: documentation
      agents: [documentarian]
      requires_consensus: false

    - name: review
      agents: [reviewer]
      requires_consensus: true
      optional: true

    - name: repo_hygiene
      agents: [steward]
      requires_consensus: true
      optional: true  # Ad-hoc phase, not part of standard workflow
      artifacts_required:
        - reports/repo_hygiene_report.md
        - reports/PR_PLAN.md

  # Phase transition rules
  transitions:
    auto_advance: false  # Require explicit orchestrator approval
    rollback_enabled: true
    max_iterations: 3  # Maximum iterations per phase before escalation

# Checkpoint policy
checkpointPolicy:
  enabled: true
  storage_path: .claude/checkpoints/
  versioning: true
  retention_policy:
    keep_all_approved: true
    keep_last_n_rejected: 5

  validation:
    require_consensus_approval: true
    require_all_artifacts: true
    allow_partial_checkpoints: false

# Orchestrator settings
orchestrator:
  state_file: .claude/orchestrator_state.json
  log_level: info
  max_parallel_agents: 1  # Sequential by default
  timeout_minutes: 30

  # Natural language triggers
  nl_triggers:
    - phrase: "new project"
      command: "intake new"
    - phrase: "create new project"
      command: "intake new"
    - phrase: "start a new project"
      command: "intake new"
    - phrase: "begin project intake"
      command: "intake new"
    - phrase: "tidy repo"
      command: "run repo-hygiene"
    - phrase: "cleanup repository"
      command: "run repo-hygiene"
    - phrase: "hygiene check"
      command: "run repo-hygiene"
    - phrase: "cleanliness report"
      command: "run repo-hygiene"
    - phrase: "repo health"
      command: "run repo-hygiene"
    - phrase: "check repo health"
      command: "run repo-hygiene"
    - phrase: "weekly hygiene"
      command: "run repo-hygiene"
    - phrase: "show cleanliness"
      command: "run repo-hygiene"

  default_intake_template: "intake/templates/starter.webapp.yaml"
  busy_blocking: true

  # Handoff configuration
  handoff:
    include_full_context: true
    artifact_format: markdown
    preserve_history: true

# Integration settings
integrations:
  git:
    auto_commit_checkpoints: false
    branch_per_phase: false

  notifications:
    enabled: false
    channels: []
